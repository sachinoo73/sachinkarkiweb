---
title: "Exploring airbnb"
author: "Su Yiin Ang"
date: "3/19/2021"
output: 
  html_document:
    toc: TRUE
    toc_float: true
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = TRUE)
```

# 1. Overview

## 1.1 Purpose

## 1.2 Literature review

## 1.3 Components of visualisation

## 1.4 Sketch of proposed visualisation

# 2. Interactivity

# 3. Step-by-step Data Visualisation Preparation

## 3.1 Installing and launching R packages

```{r, message = FALSE}
packages <- c('tidyverse','ggstatsplot','plotly','readr','haven','funModeling','crosstalk','data.table','shiny', 'shinyWidgets')

for (p in packages){
  if (!require(p,character.only=T)){
    install.packages(p)
  }
  library(p, character.only=T)
}
```

## 3.2 Data preparation
### 3.2.1 Data source



### 3.2.2 Load data into R
The data was imported using the `read_csv()` of the readr package.

```{r}
# Read the csv file as a tbl_df
final_listings <- read_csv("./data/listing_prep.csv")

```

## 3.3 Data visualisation

### 3.3.1 Select and observe variables' summary

3 components 
- Select variables for observation
- Summary of selected variables
- Data table of selected variables

```{r}
pickerInput('selected_v', 
           'Select variables for observation', 
           choices = names(final_listings),
           options = list(`actions-box` = TRUE,
                          size = 10,
                          `selected-text-format` = "count > 3"),
           multiple = TRUE)


renderPrint({
  selectedData <- final_listings[, input$selected_v, drop = FALSE]
  summary(selectedData)
})

DT::renderDataTable({
  selectedData <- final_listings[, input$selected_v, drop = FALSE]
  DT::datatable(selectedData)
  })

```

### 3.3.2 Exploratory Data Analysis

Univariate analysis

```{r}
bscols(widths = c(3,9),
       list(
         selectInput(inputId = 'x_var',
                     label = 'Select x-variable',
                     choices = colnames(final_listings),
                     selected = 'review_scores_rating'), #why is my date showing as number???
         
         renderText({
          x <- unlist(final_listings[,input$x_var])
          paste("Selected variable's data type: ", class(x))
          }),
         
         checkboxInput(inputId = 'show_stats', 
                    label = "Show statistics?",
                    value = TRUE),
         
         renderPrint({
         x <- final_listings[, input$x_var, drop = FALSE]
         if(input$show_stats){summary(x)}
         })
        ),
       list(
         renderPlotly({
           x <- unlist(final_listings[,input$x_var])
  
           plot_ly(x = x, type = 'histogram') %>%
             layout(title = paste("Distribution of ", input$x_var), 
                    xaxis = list(title = (input$x_var)),
                    yaxis = list(title = 'count'))
        }),
        
        renderPlotly({
         x <- unlist(final_listings[,input$x_var])
         
         if(class(x) == class(final_listings$review_scores_rating)) {
           plot_ly(type = 'box') %>%
           add_boxplot(x = x, name = input$x_var, boxpoints = "outliers") %>%
           layout(title = paste("Outlier boxplot of ", input$x_var),
                                showlegend = FALSE)
           } else {stop("Outlier boxplot is not meaningful for non-numerical classes.") 
             
             }
         })
       ))
```


Bivariate analysis

```{r}
bscols(widths = c(3,9),
       list(
         renderText({
          x_bi <- unlist(final_listings[,input$x_bi_var])
          paste("x-variable: ", class(x_bi))
          }),
         
         selectInput(inputId = 'x_bi_var',
            label = 'Select x-variable',
            choices = colnames(final_listings),
            selected = 'neighbourhood_cleansed'),
         
         renderText({
          y_bi <- unlist(final_listings[,input$y_bi_var])
          paste("Y variable - ", class(y_bi))
          }),
         
         selectInput(inputId = 'y_bi_var',
            label = 'Select y-variable',
            choices = colnames(final_listings),
            selected = 'price_per_pax'),

         selectInput(inputId = 'chart',
                     label = "Select chart type",
                     choices = c("bar", "scatter", 'box'),
                     selected = 'box'),
         
         selectInput(inputId = 'colour',
                     label = 'Colour chart by:',
                     choices = colnames(final_listings),
                     selected = 'neighbourhood_group_cleansed')
       ),
       renderPlotly({
         x_bi <- unlist(final_listings[,input$x_bi_var])
         y_bi <- unlist(final_listings[,input$y_bi_var])
         c_bi <- unlist(final_listings[,input$colour])
         
         plot_ly(x = x_bi, y = y_bi, color = c_bi,
                 type = input$chart) %>%
                layout(title = paste(input$x_bi_var, 'vs', input$y_bi_var),
                       xaxis = list(title = input$x_bi_var),
                       yaxis = list(title= input$y_bi_var))
         
       })
       
)

```


### 3.3.3 Confirmatory Data Analysis
```{r}
plot_ly(x = final_listings$neighbourhood_cleansed, 
       y = final_listings$price_per_pax, 
       color = final_listings$neighbourhood_group_cleansed,
       type = 'box') %>%
layout(title = "", 
       xaxis = list(title = "x-var",
                    categoryorder = "price_per_pax",
                    categoryarray = "price_per_pax"),
       yaxis = list(title= "y-var"))

```
