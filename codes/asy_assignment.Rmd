---
title: "Exploring airbnb"
author: "Su Yiin Ang"
date: "3/19/2021"
output: 
  html_document:
    toc: TRUE
    toc_float: true
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

# 1. Overview

## 1.1 Purpose

## 1.2 Literature review

## 1.3 Components of visualisation

## 1.4 Sketch of proposed visualisation

# 2. Interactivity

# 3. Step-by-step Data Visualisation Preparation

## 3.1 Installing and launching R packages

```{r, message = FALSE}
packages <- c('tidyverse','ggstatsplot','plotly','readr','leaflet','haven','funModeling')

for (p in packages){
  if (!require(p,character.only=T)){
    install.packages(p)
  }
  library(p, character.only=T)
}
```

## 3.2 Data preparation
### 3.2.1 Data source



### 3.2.2 Load data into R
The data was imported using the `read_csv()` of the readr package.

```{r}
# Read the csv file as a tbl_df
listings <- read_csv("./data/clean/listing_en.csv")

```

Now we take alook at the merged dataset
```{r}
glimpse(listings)
```

Here we see that there are 4,255 listings and 74 columns. Some columns are not useful

### 3.2.3 Data cleaning

**Missing data**
Use `status` to check for missing data, zeros, data type of the data frame.

```{r}
status(listings)
```

**Exclude unwanted variables**

We want to exclude  

(1) variables that will not be used for the analysis so that users will not be overwhelmed by the number of variables when performing selection.  

(2) variables with high percentage of missing values as they will skew the observation.

```{r}
listings <- listings %>%
  select(-c(host_name,listing_url, scrape_id, last_scraped, name, picture_url,host_id, host_url,  host_location, host_about,host_thumbnail_url, host_picture_url, host_listings_count, neighbourhood, bathrooms, host_verifications,calendar_updated,calendar_last_scraped, first_review,last_review,license, description_lang))
```

**Change variable type**

Examine the classes of each of the columns to make sure they are correctly specified.

We observed that `price`, `host_response_rate` and `host_acceptance_rate` are in `chr` type, however they should be in `dbl` or `int` type.

```{r}
final_listings <- listings %>%
  mutate(price, price = parse_number(listings$price)) %>%  
  mutate(host_response_rate, host_response_rate = parse_number(host_response_rate, na = c("", "NA"), locale = default_locale(), trim_ws = TRUE)) %>%
           mutate(host_acceptance_rate, host_acceptance_rate = parse_number(host_acceptance_rate, na = c("", "NA"), locale = default_locale(), trim_ws = TRUE))
```

**Final dataset for EDA and CDA**

```{r}
glimpse(final_listings)
```

## 3.3 Data visualisation

```{r}
leaflet(data = listings) %>% 
  addTiles() %>% 
  addCircleMarkers(lng = ~longitude,
                   lat = ~latitude,
                   popup = ~as.character(listings$description, listings$price),
                   clusterOptions = markerClusterOptions()) 

```
