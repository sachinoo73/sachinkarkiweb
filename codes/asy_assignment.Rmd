---
title: "Exploring airbnb"
author: "Su Yiin Ang"
date: "3/19/2021"
output: 
  html_document:
    toc: TRUE
    toc_float: true
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = TRUE)
```

# 1. Overview

## 1.1 Purpose

## 1.2 Literature review

## 1.3 Components of visualisation

## 1.4 Sketch of proposed visualisation

# 2. Interactivity

# 3. Step-by-step Data Visualisation Preparation

## 3.1 Installing and launching R packages

```{r, message = FALSE}
packages <- c('tidyverse','ggstatsplot','plotly','readr','leaflet','haven','funModeling','crosstalk','RColorBrewer','data.table','shiny')

for (p in packages){
  if (!require(p,character.only=T)){
    install.packages(p)
  }
  library(p, character.only=T)
}
```

## 3.2 Data preparation
### 3.2.1 Data source



### 3.2.2 Load data into R
The data was imported using the `read_csv()` of the readr package.

```{r}
# Read the csv file as a tbl_df
listings <- read_csv("./data/clean/listing_en.csv")

```

Now we take alook at the merged dataset
```{r}
glimpse(listings)
```

Here we see that there are 4,255 listings and 74 columns. Some columns are not useful

### 3.2.3 Data cleaning

**Missing data**
Use `status` to check for missing data, zeros, data type of the data frame.

```{r}
listings_status <- status(listings)
arrange(listings_status, -p_na) %>%
  select(variable, q_na, p_na)
```

**Notes**
- q_zeros: quantity of zeros  
- p_zeros: percentage of zeros  
- q_na: quantity of NA  
- p_na: percentage of NA  
- type: data type, factor or numeric  
- unique: quantity of unique values, useful for categorical data  

Observations with missing `review_scores_rating` values were removed due to this being the target variable.

```{r}


```

**Exclude unwanted variables**

We want to exclude  

(1) redundant variables that will not be used for the analysis so that users will not be overwhelmed by the number of variables when performing selection,  

(2) variables with high percentage of missing values as they will skew the observation.

```{r}
listings <- listings %>%
  select(-c(listing_id, host_name, description, listing_url, scrape_id, last_scraped, name, picture_url,host_id, host_url,  host_location, host_about,host_thumbnail_url, host_picture_url, host_listings_count, host_neighbourhood, neighbourhood, neighborhood_overview, bathrooms, host_verifications,calendar_updated,calendar_last_scraped, first_review,last_review,license, description_lang, amenities, latitude, longitude))
```

**Change variable type**

Examine the classes of each of the columns to make sure they are correctly specified.

We observed that `price`, `host_response_rate` and `host_acceptance_rate` are in `chr` type, however they should be in `dbl` or `int` type.

```{r}
final_listings <- listings %>%
  mutate(price, price = as.numeric(gsub('\\$|',"", listings$price))) %>%  
  mutate(host_response_rate, host_response_rate = as.numeric(gsub('\\%|',"", listings$host_response_rate))) %>%
  mutate(host_acceptance_rate, host_acceptance_rate = as.numeric(gsub('\\%|',"", listings$host_acceptance_rate)))
```

## 3.3 Data visualisation

### 3.3.1 Select and observe variables' summary

3 components 
- Select variables for observation
- Summary of selected variables
- Data table of selected variables

```{r}
bscols(widths = c(3,9),
       list(
         checkboxGroupInput('selected_v', 
                            'Select variables for observation', 
                            choices = names(final_listings), 
                            selected = c('price', 'host_is_superhost','review_scores_rating'))
       ),
       renderPrint({
         selectedData <- final_listings[, input$selected_v, drop = FALSE]
         summary(selectedData)
         }),
       
       DT::renderDataTable({
         selectedData <- final_listings[, input$selected_v, drop = FALSE]
         DT::datatable(selectedData)
         })
       )
```

### 3.3.2 Exploratory Data Analysis

Univariate analysis

```{r}
bscols(widths = c(3,9),
       list(
         selectInput(inputId = 'x_var',
                     label = 'Select x-variable',
                     choices = colnames(final_listings)), #why is my date showing as number???
         "Selected variable's data type is  ",
         renderText({
          x <- unlist(final_listings[,input$x_var])
          class(x)
          })
        ),
  
       renderPlotly({
         x <- unlist(final_listings[,input$x_var])
         plot_ly(x = x,
               type = 'histogram') #is there a way to label x,y axis and title? layout did not work
         })
       )
```



----------------------
asy to continue here
-----------

Bivariate analysis

```{r}
bscols(widths = c(3,9),
       list(
         selectInput(inputId = 'x_var',
            label = 'Select x-variable',
            choices = colnames(final_listings)),
         
         selectInput(inputId = 'y_var',
            label = 'Select y-variable',
            choices = colnames(final_listings)),
         
         selectInput(inputId = 'chart',
                     label = "Select chart type",
                     choices = c("bar", "scatter", 'boxplot', 'mosaic'))
       ),
       renderPlotly({
         x <- unlist(final_listings[,input$x_var])
         y <- unlist(final_listings[,input$y_var])
         chart <- unlist(final_listings[,input$chart])
         plot_ly(x = x, y = y,
               type = chart)
         
       })
       
)

```


### 3.3.3 Confirmatory Data Analysis





